# Cryptography

*Author: Yang Bowen*
*Last modified: 2022/12/18*
# 引言

密码系统的组成

> 明文、密文、密钥、加密算法、解密算法
> 
- 密码编码学
    - 保密体制
        - 对称体制
            - 分组密码
            - 序列密码
        - 非对称体制
    - 认证体制
- 密码分析学

柯克霍夫准则

## 保密体制的安全性

- 唯密文攻击 Ciphertext Only
- 已知明文攻击 Known Plaintext
- 选择明文攻击 Chosen Plaintext
- 选择密文攻击 Chosen Ciphertext
- 选择文本攻击 Chosen Text（3+4）

## 认证体制的安全性

- 唯密钥攻击
- 已知的消息攻击
- 一般的选择消息攻击
- 特殊的选择消息攻击
- 自适应的选择消息攻击

## 香农理论

一次一密不可破译

## 问题的复杂度

P问题：图灵机上确定的多项式时间内可解

NP问题：图灵机上非确定的多项式时间内可解

NP包含P

# Classical Cryptography

主要通过字符间的简单置换和代换实现，分为置换密码和代换密码

## 置换密码

aka换位密码

### 列置换密码

矩阵行长度为密钥中最大数

加密时：明文填充入矩阵时逐行填充 且 密文取出时逐列取出

### 周期置换密码

每组长度为密钥中最大数

## 代换密码

### 单表代换密码

移位密码：容易被穷举攻击

仿射加密：模上的多项式建立明文/密文字符映射关系

- 密钥空间为`n*n的欧拉函数值`，其中n为字符数

单表代替密码

### 多表代换密码

### 维吉尼亚密码

构造代换表：使用一个长度为k的单词构造代换，密钥空间为26**k

### Playfair密码

构造代换表：5*5字符矩阵，I/J放在一个空位内

加密：字母两两一组进行操作

### 希尔密码

加密：将明文字符数字化后乘密钥矩阵，得到的值模26后再转化成字母

### Vernam代数密码

序列密码的起源

将26个英文字母用比特编码，按该规则对明文编码得到比特流

加密：选择同明文比特流同样长度的密钥进行按位异或

## 密码分析

### 字母频率分析法

针对单表代换

### Kasiski卡希斯基测试法

针对多表代换

> 若用给定的k个密钥表周期地对明文字母加密， 则当明文中有两个相同字母组在明文序列中间隔的字母数为k的倍数时，这两个明文字母组对应的密文字母组必相同。但反过来，若密文中出现两个相同的字母组，它们所对应的明 文字母组未必相同，但相同的可能性很大。如果我们将密文 中相同的字母组找出来，并对其相同字母数综合研究，找出 它们的相同字母数的最大公因子，就有可能提取出有关密钥字的长度k的信息。
> 

### 重合指数法

针对多表代换，利用随机文本和英文文本的统计概率分析密钥长度

### 明文-密文对分析法

可以对希尔密码这种抵御频率分析较强的密码进行有效破译

# 分组密码

分组密码又名块密码（block cipher）。

扩散：

> 所谓扩散，是指要将算法设计成明文每一比特的变化尽 可能多地影响到输出密文序列的变化，以便隐蔽明文的统计 特性。形象地称为雪崩效应。
> 
> 
> 扩散的另一层意思是密钥每一位的影响尽可能迅速地扩 展到较多的密文比特中去。即扩散的目的是希望密文中的任 一比特都要尽可能与明文、密钥相关联，或者说，明文和密钥中任何一比特值发生改变，都会在某种程度上影响到密文值的变化，以防止将密钥分解成若干个孤立的小部分，然后各个击破。
> 

混淆：

> 所谓混淆，是指在加解密变换过程中使明文、密钥以及密文之间的关系尽可能地复杂化，以防密码破译者采用解析法(即通过建立并求解一些方程)进行破译攻击。
> 
> 
> 混淆可以用“搅拌机”来形象地解释，将一组明文和一组密钥输入到算法中，经过充分混合，最后变成密文。同时要求，执行这种混淆作业的每一步都必须是可逆的，即明文混乱以后能得到密文，反之，密文经过逆向的混淆操作以后能恢复出明文。（按照混淆原则，分组密码算法应有复杂的非线性因素）
> 

S盒：代换（二进制异或）

P盒：置换（换位）

## DES(Data Encryption Standard)密码

明文密文按64位分组

密钥长度为64位（含8bit校验位）

 子密钥长度为48bit

16轮迭代

轮函数：扩展置换E盒 32 -> 48

 与子密钥异或

 压缩替代（非线性置换）S-盒 48 -> 32：6bit至4bit

 线性置换P盒

互补性

弱密钥和半弱密钥

多重DES

## AES(Advanced Encryption Standard)密码

明文密文按128位分组

密钥长度为128位，10轮

密钥长度为192位，12轮

密钥长度为256位，14轮

> AES的结构的一个显著特征是不同于DES的结构，输入的密钥被扩展成由44个32位字所组成的数组w[i]。 AES结构由四个不同的阶段组成：字节代换、行移位、列混淆、轮密钥加。 仅仅在轮密钥加阶段中使用密钥，并在算法的开始和结束都都使用轮密钥加阶段。每个阶段均可逆，解密算法和加密算法并不一样。加密和解密过程的最后一轮均只包含3个阶段，这是由AES的 特定结构所决定的。
> 

AES分组：4字节一组，分成4*4矩阵

字节代换中S盒（ByteSub）：

> 列的每个元素作为输入用来指定S盒的地址：前4位指定S盒的行，后4位指定S盒的列。由行和列所确定的S盒位置的元素取代了明文矩阵中相应位置的元素。
> 

行移位（ShiftRow）：

> 行移位操作是作用于S盒的输出的，其中，列的4个行螺旋地左移，即第0行左移0字节，第1行左移1字节，第2行左移2字节，第3行左移3字节，这使得列完全进行了重排，即在移位后的每列中，都包含有未移位前每个列的一个字节。接下来就可以进行列内混合了。
> 
> 
> 因此，行移位将某个字节从一列移到另一列中，这个 变换确保了某列中的4字节被扩展到了4个不同的列。
> 

列混淆（MixColumn）

> 列混淆是通过矩阵相乘，经行移位后的状态矩阵与固定的矩阵相乘，得到混淆后的状态矩阵。
> 
> 
> 对于1个8位的二进制来说，使用域上的乘法乘以0x02(00000010)等价于左移1位，再根据情况同（00011011）进行异或运算；对于1个8位的二进制来说，使用域上的乘法乘以0x03(00000011)可以拆分为先分别乘以(0000 0001)和(0000 0010), 再将两个乘积异或。
> 
> 列混淆变换的矩阵系数是基于在码字间有最大距离的线性编码，这使得在每列的所有字节中有良好的混淆性。列混淆变换和行移位变换使得在经过几轮变换后，所有的 输出位均与所有的输入位相关。 此外，列混淆变换的系数，即{01}，{02}，{03}是基于算法执行效率考虑的，而逆向列混淆变换中的系数并不是出于效率的考虑，加密被视为比解密更重要。
> 

AES加密和解密算法不对称，避免了弱密钥 AES具有较好的抗差分分析和线性分析的能力 AES可抗密钥穷举攻击

DES是面向比特的运算，AES是面向字节的运算 AES的加密运算和解密运算不一致，因而加密器不能同时用作解密器，DES则无此限制

## SM4密码

中国第一个商用分组密码算法，2006年公布 数据分组长度128位，密钥长度128位 数据处理单位：字节（8位），字（32位）

基本轮函数+32轮迭代 解密算法与加密算法相同

# 分组密码操作模式

- ECB是最快、最简单的分组密码模式，但它的安全性最弱，一般不推荐使用ECB加密消息，但如果是加密随机数据，如密钥，ECB则是最好的选择。
- CBC适合文件加密，而且有少量错误时不会造成同步失败，是软件加密的最好选择。
- CFB通常是加密字符序列所选择的模式，它也能容忍少量错误扩展，且具有同步恢复功能。
- OFB是在极易出错的环境中选用的模式，但需有高速同步机制。

## ECB 电子密码本模式

- 无明文错误扩散
- 无密文错误扩散

模式操作简单，主要用于内容较短且随机的报文的加密传递

各组的加密都独立于其它分组，可实现并行处理。相同明文（在相同密钥下）得出相同的密文，即明文中的重复内容将在密文中表现出来，容易实现统计分析攻击、分组重放攻击和代换攻击。单个密文分组中有一个或多个比特错误只会影响该分组的解密结果

## CBC 密码分组链接模式

- 无明文错误扩散
- 密文错误扩散很小。一个分组的bit错误最多扩散到下一组

一种反馈机制在分组密码中的应用，每个密文分组不仅依赖于产生它的明文分组，还依赖于它前面的所有分组

相同的明文，即使相同的密钥下也会得到不同的密文分组，隐藏了明文的统计特性；对于一个正确密文分组的正确解密要求它之前的那个密文分组也正确，不能实现并行处理；密文分组中的一个单比特错误会影响到本组和其后分组的解密，错误传播为两组

初始化向量IV不需要保密，它可以明文形式与密文一起传送

## CFB 密码反馈模式

- 无明文错误扩散
- 密文错误扩散较大
- 有自同步特性

消息被看作bit流，不需要整个数据分组在接收完后才能进行加解密；对信道错误较敏感且会造成错误传播；数据加解密的速率降低，其数据量不会太高

## OFB 输出反馈模式

- 无明文错误扩散
- 密文错误扩散同CBC
- 失去同步很致命

OFB模式是CFB模式的一种改进，克服由错误传播带来的问题，但对密文被篡改难于进行检测；OFB模式不具有自同步能力，要求系统保持严格的同步，否则难于解密

初始向量IV无需保密，但各条消息必须选用不同的IV

# 序列密码

序列密码通常认为起源于20世纪20年代的Vernam密码，Vernam密码中的密钥序列要求是随机的序列，由于随机的密钥序列的产生、存储以及分配等方面存在一定的困难， Vernam体制在当时并没有得到广泛的应用。随着微电子技术和 数学理论的发展和完善，基于伪随机序列的序列密码得到了长 足的发展和应用，其产生有比较成熟的数学理论工具。如果密钥序列是随机的序列，则序列密码就是“一次一密”密码体制。 香农已经证明“一次一密”密码体制在理论上是不可破译的。 目前，序列密码是世界各国的军事和外交等重要领域中使用的 主要密码体制之一。 在序列密码中，加密和解密所用的密钥序列都是伪随机序列，序列密码是对称密码体制中的一类，又称为流密码。

序列密码相较于分组密码的优点：

> 在硬件实施上，序列密码的速度一般要比分组密码快，而 且不需要有很复杂的硬件电路。 在某些情况下（例如某些电信上的应用），当缓冲不足或必须对收到字符进行逐一处理时，序列密码就显得更加必要和恰当。 序列密码有较理想的数学分析。 序列密码能较好地隐藏明文的统计特性。
> 
> 
> 序列密码的密钥分配困难。
> 
> 序列密码不存在数据扩展和数据传播。
> 

密钥序列产生器（KG）

反馈移位寄存器（Feedback Shift Register）

游程：全为0或全为1的序列

## 线性反馈移位寄存器（Linear Feedback Shift Register）

 线性反馈移位寄存器输出序列的性质完全由其反馈函数决定。只要找到合适的反馈函数便可使序列周期达到最大值2**n - 1，周期达到最大值的序列为m序列

 抽头位：反馈函数中参与运算的位

 抽头位对输出周期长度的影响起着决定性的作用

 初态对输出周期长度没有影响

## 非线性序列

Geffe触发器

J-K触发器

Pless生成器

门限发生器

## RC4（Rivest Cipher 4）

> RC4（Rivest Cipher）是RSA数据安全公司开发的可变密钥长度的序列密码，是世界上使用最广泛的序列密码之一，其优点是很容易用软件实现，加解密速度快（大约比DES快10倍）。与基于移位寄存器的序列密码不同，RC4密码是一种基于非线性数据表变换的序列密码。它以一个足够大的数据表为基础，对表进行非线性变换，产生非线性的密钥流序列。
> 

一个可变密钥长度、面向字节操作的序列密码，该算法以随机置换作为基础。分析显示该密码的周期大于10**100

RC4包含KSA（Key Scheduling Algorithm）和PRGA（Pseudo Random-Generation Algorithm）

种子密钥长度：1-256字节

# 公钥密码

公钥密码是建立在数学函数基础上的，而不是像之前的密码学建立在位方式的操作上的

## MH背包问题

存在两类不同的背包问题：一类在线性时间内可解(超递增背包问题)，而另一类不能(普通背包问题)。易解的背包问题可以转化成难解的背包问题。公钥使用难解的背包问题，它可很容易地被用来加密明文但不能用来解密密文。私钥使用易解的背包问题，它给出一个解密的简单方法。不知道私钥的人要破解密文就不得不解一个难解的背包问题。 将消息编码为背包问题的解。明文分组长度等于堆中物品个数，密文是计算得到的和值。

## RSA

## ElGamal

## ECC

## IBE

# 散列函数和消息认证

消息认证的方式

- 散列函数（Hash）
- 消息认证码（MAC）

## 散列函数

散列函数是一种算法，生成消息摘要aka散列码

散列函数又称为：哈希（Hash）函数、数字指纹（Digital Fingerprint)、压缩（Compression）函数、数据认证码（Data Authentication Code）等

算法实现步骤

- 将原始消息分组成block，每一个为Yi
- 将最后一个block进行padding，使所有块长度均相同
- 设置初始值CV0
- 压缩函数进行迭代，每轮产出CVi=f(CVi-1, Yi)
- 最后得到的CV为消息摘要

## 基于分组密码的Hash函数

采用分组密码CBC工作模式

## MD5

输入：任意长度消息

分组：512bit

输出：128bit

算法实现步骤

- 对消息进行填充使其比特数与448模512同余
- padding：将比特串最高位置1，其余位为0（最少补1bit，最多512bit）
- 初始化链向量CV0
- 处理消息分组
- 输出结果

## MAC

MAC is for Message Authentication Code aka Cryptographic checksum（密码校验和）

MAC的设计含有密钥，但MAC不需要可逆性，所以相对于加密函数被攻击的弱点更少

### 基于DES的CBC-MAC

# 数字签名

- 所谓数字签名(Digital Signature)，也称电子签名，是指附加在某一电子文档中的一组特定的符号或代码，它是利 用数学方法和密码算法对该电子文档进行关键信息提取并进行加密而形成的，用于标识签发者的身份以及签发者对电子 文档的认可，并能被接收者用来验证该电子文档在传输过程中是否被篡改或伪造
- 与消息认证的的区别：消息认证使收方能验证消息发送者及所发消息内容是否被窜改过。当收者和发者之间有利害冲突时，就无法解决他们之间的纠纷，此时须借助满足前述要求的数字签字技术
- 实现认证性、完整性、不可否认性，产生签名的唯一途径是使用私钥

## 基于对称密码的签名

### RSA数字签名

## 基于离散对数的签名

### ElGamal数字签名

### Schnorr数字签名

### DSA数字签名

## 基于椭圆曲线的签名

### ECC数字签名

# 密钥分配

## PKI信任模型

- 单一模型CA
- 树状模型CA
- 对等模型CA

DH密钥交换协议

Shamir门限
