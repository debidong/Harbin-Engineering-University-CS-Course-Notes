# 网络与系统安全

*Author: Yang Bowen*

*Last modified: 2023/6/20*

# 1 网络安全基础

*Chapter 1*

## 信息安全的三个基本目标

- 保密性：确保信息不被泄露或呈现给非授权的人
- 完整性：确保数据的一致性
- 可用性：需要的时候可用

## 基本威胁的种类

- 信息泄露 <- 保密性
- 完整性破坏 <- 完整性
- 拒绝服务 <- 可用性
- 非法使用 <- 可用性

## 安全防护措施

- 物理安全
- 人员安全
- 管理安全
- 媒体安全
- 辐射安全
- 生命周期控制

## 网络安全策略分级

- 安全策略目标
- 机构安全策略
- 系统安全策略

## 被动攻击

- **窃听攻击**
- **流量分析**

## 主动攻击

- **伪装攻击**
- **重放攻击**
- **消息篡改**
- **拒绝服务**

## **网**络安全模型

- **信源**
- **信宿**
- **安全变换**
- **信息通道**
- **可信第三方**
- **攻击者**

# 2 TCP/IP协议簇的安全性

*Chapter 3*

## IP基本理解

## TCP和UDP的区别

TCP（Transmission Control Protocol）和UDP（User Datagram Protocol）是两种常用的传输层协议，用于在计算机网络中传输数据。它们在功能和特性上有以下主要区别：

1. 可靠性：TCP是一种可靠的传输协议，它通过使用确认、重传和流量控制等机制来确保数据的可靠传输。TCP保证数据的有序性和完整性，以及可靠的错误检测和纠正。而UDP是一种无连接的传输协议，它不提供可靠性保证。UDP将数据包发送到目标地址，但不对数据传输进行确认和重传，因此可能会丢失或乱序。

2. 连接性：TCP是面向连接的协议，需要在通信双方建立连接之后才能进行数据传输。连接的建立和维护需要一定的时间和资源开销。而UDP是无连接的协议，数据包可以直接发送到目标地址，无需先建立连接。

3. 传输效率：由于TCP提供了可靠性保证，它在数据传输过程中需要执行额外的流量控制、确认和重传操作，以及拥塞控制机制。这些额外的机制会引入一定的延迟和开销，使得TCP的传输效率相对较低。相比之下，UDP不需要这些额外的机制，因此传输效率较高。

4. 数据量和大小：TCP对数据包的大小没有限制，可以传输任意大小的数据。UDP对数据包的大小有限制，每个数据包的最大大小限制在64KB以内。

5. 适用场景：由于TCP提供了可靠性和顺序性保证，它适用于需要确保数据完整性和顺序的应用，如文件传输、电子邮件、网页浏览等。而UDP适用于实时性要求较高、数据传输量较小且容忍丢包的应用，如实时音视频传输、在线游戏和DNS查询等。

综上所述，TCP和UDP在可靠性、连接性、传输效率和适用场景等方面有明显的区别，应根据具体应用需求来选择适合的传输协议。

## 名词理解

- IP

  >IP协议（Internet Protocol）是互联网中用于进行数据包传输的一种网络协议。它是在网络层（第三层）中工作，负责在网络中标识和定位设备，并提供数据包的传输和路由功能。
  >
  >IP协议定义了一种统一的数据包格式，称为IP数据报（IP datagram），它包含了源IP地址和目标IP地址以及其他相关的控制信息。每个连接到互联网的设备都被分配一个唯一的IP地址，通过这个地址，数据包可以被发送到目标设备。
  >
  >IP协议是一种无连接的协议，这意味着每个数据包都是独立传输的，没有建立持久的连接。每个数据包在传输过程中可以通过不同的路径和中间节点进行路由，这样可以实现网络的冗余和容错能力。
  >
  >除了提供数据包的传输功能，IP协议还定义了一些其他重要的功能，包括：
  >
  >1. 地址分配和管理：IP协议定义了IP地址的分配和管理机制，以确保每个设备都具有唯一的地址，并能够在网络中正确地定位和识别。
  >2. 路由选择：IP协议使用路由选择算法来确定数据包的最佳路径和下一跳节点，以实现数据包在网络中的传输。
  >3. 分段和重组：当数据包的大小超过网络的最大传输单元（MTU）时，IP协议会将数据包分成更小的片段进行传输，并在目标设备上重新组装它们。
  >4. 错误检测和校正：IP协议使用校验和来检测数据包在传输过程中是否发生了错误，以保证数据的完整性。
  >
  >IP协议是互联网的核心协议之一，它为上层的协议（如TCP、UDP等）提供了基础的网络通信能力。它使得互联网上的各种设备能够相互通信和交换数据。

- ARP

  > ARP（Address Resolution Protocol）是一种用于将IP地址映射到物理MAC地址的网络协议。它在以太网或其他局域网中起到重要的作用，用于解析网络设备之间的通信。
  >
  > 在局域网中，每个设备都有一个唯一的物理地址，称为MAC地址。而在IP网络中，设备使用IP地址来进行通信。ARP协议的目标是通过将IP地址与对应的MAC地址进行映射，使得设备能够在局域网中正确地发送和接收数据。
  >
  > 当一个设备需要与局域网上的另一个设备通信时，它首先会检查自己的ARP缓存（ARP cache），其中保存了已知IP地址和对应的MAC地址的映射关系。如果在ARP缓存中找到了对应的映射关系，设备就可以直接使用MAC地址进行通信。
  >
  > 如果设备在ARP缓存中没有找到所需的映射关系，它会发送一个ARP请求广播消息到局域网上的所有设备。该ARP请求消息中包含了需要解析的IP地址。接收到这个请求的设备会检查自己的IP地址，如果发现与请求中的目标IP地址匹配，就会回复一个ARP响应消息，其中包含自己的MAC地址。这样，请求设备就能够获取到所需的IP地址和MAC地址的映射关系，并将其存储到ARP缓存中，以备以后使用。
  >
  > ARP协议的运作是透明的，对应用层而言是无感知的。它在网络中起到了重要的作用，使得设备能够在局域网中动态地解析IP地址和MAC地址的映射关系，从而实现设备之间的正常通信。

- TCP

  > TCP（Transmission Control Protocol）是互联网通信中使用的一种可靠的传输协议。它是基于连接的、面向流的协议，提供了高可靠性的数据传输和错误恢复机制。
  >
  > TCP协议在传输层（第四层）中工作，它建立在IP协议之上，为应用程序提供了可靠的数据传输服务。以下是TCP协议的一些关键特点和工作机制：
  >
  > 1. 连接导向：TCP协议使用三次握手建立连接和四次挥手关闭连接的机制。在通信之前，发送方和接收方首先要建立一个TCP连接，以确保双方之间的通信正常进行。连接的建立和断开过程都是经过双方的确认和同步的。
  >
  > 2. 可靠性：TCP协议提供了可靠的数据传输，通过使用序列号、确认应答和重传机制来确保数据的完整性和正确性。接收方会对接收到的数据进行确认应答，如果发送方没有收到确认应答，就会重传数据，从而保证数据的可靠传输。
  >
  > 3. 流控制：TCP协议使用滑动窗口机制来进行流量控制。发送方根据接收方的处理能力和网络状况，动态地调整发送数据的速率，以防止接收方缓冲区溢出和网络拥塞。
  >
  > 4. 拥塞控制：TCP协议具有拥塞控制机制，用于检测和避免网络拥塞。通过动态调整发送速率和控制拥塞窗口大小，TCP可以避免网络拥塞的发生，并保持网络的稳定性和吞吐量。
  >
  > 5. 面向字节流：TCP协议将数据视为连续的字节流，没有固定的消息边界。发送方将数据分割为适合网络传输的数据段，接收方将数据段重新组装为完整的数据流。
  >
  > TCP协议被广泛应用于各种应用程序，包括网页浏览、文件传输、电子邮件、远程登录和网络游戏等。它提供了可靠的数据传输和流控制机制，确保数据的完整性和可靠性，使得应用程序能够在不可靠的互联网上进行稳定的通信。

- UDP

  > UDP（User Datagram Protocol）是一种简单的传输层协议，用于在计算机网络上提供无连接的、不可靠的数据传输。与TCP协议相比，UDP更加轻量级，没有建立连接和可靠性保证的机制，适用于一些对数据传输延迟和可靠性要求较低的应用场景。
  >
  > 以下是UDP协议的一些特点和工作机制：
  >
  > 1. 无连接性：UDP是一种无连接的协议，通信双方之间不需要建立连接。发送方将数据封装成数据报（Datagram）并直接发送给接收方，没有握手和确认的过程。
  >
  > 2. 不可靠性：UDP不提供数据传输的可靠性保证，它没有重传机制和确认应答。一旦数据报发送出去，UDP就不再对其进行跟踪和管理，无法保证数据报的到达、顺序和完整性。
  >
  > 3. 高效性：由于没有连接建立和可靠性保证的开销，UDP具有较低的延迟和资源消耗。它适用于实时性要求较高的应用，如音视频传输、实时游戏等。
  >
  > 4. 数据报形式：UDP将数据分割为数据报，每个数据报都包含源端口号和目标端口号的信息，以便接收方能够识别和处理数据。每个数据报都是独立的，没有固定的消息边界。
  >
  > 5. 多播和广播支持：UDP协议支持多播（Multicast）和广播（Broadcast）通信，可以将数据报发送给多个接收方或整个网络上的所有设备。
  >
  > UDP常用于一些对实时性要求较高的应用，如音频和视频流媒体、在线游戏、DNS（域名系统）查询等。它注重速度和效率，对于丢失一些数据包或顺序混乱的场景，可以通过应用层的处理来解决。但同时，由于UDP不提供可靠性保证，应用程序需要自行处理数据丢失、重复、顺序和完整性等问题。

- ICMP

  > ICMP（Internet Control Message Protocol）是互联网控制消息协议，它是在网络层（第三层）上工作的协议，用于在网络中传输错误和控制信息。ICMP协议通常与IP协议一起使用，用于进行网络诊断、错误报告和网络管理等功能。
  >
  > ICMP协议的主要作用是在网络中传递控制消息和错误信息。它通过在IP数据报中添加额外的ICMP消息头来实现，将这些消息发送给源主机或其他网络设备。以下是ICMP协议的一些常见用途：
  >
  > 1. Ping：ICMP协议中的Echo Request和Echo Reply消息被广泛用于网络中的主机间连通性测试。Ping命令使用Echo Request消息发送到目标主机，目标主机收到后会回复Echo Reply消息，通过测量往返时间来判断主机之间的连通性和延迟。
  >
  > 2. 错误报告：当IP数据包在传输过程中发生错误时，路由器或目标主机会使用ICMP消息通知发送方发生了错误。例如，如果目标主机不可达或某个网络发生拥塞，就会发送相应的ICMP错误消息给源主机。
  >
  > 3. 路由器发现和重定向：ICMP协议中的路由器发现和重定向消息用于网络中的路由器发现和路由表的更新。路由器发现消息帮助主机找到默认网关，而重定向消息用于向主机发送更优的路由信息。
  >
  > 4. 时间戳：ICMP协议中的时间戳消息用于测量网络中的主机时钟与标准时钟之间的差距，以帮助调整主机的时钟同步。
  >
  > ICMP消息通常由操作系统或网络设备自动发送和处理，对于一般的应用程序来说，通常不需要直接操作ICMP协议。然而，它在网络诊断、故障排除和网络管理等方面扮演着重要的角色，帮助监控和维护网络的正常运行。

- DHCP

  > DHCP（Dynamic Host Configuration Protocol）是一种网络协议，用于自动分配IP地址和其他网络配置信息给连接到网络的设备。它是在应用层（第七层）中工作的协议，通过使用客户端和服务器之间的交互来完成IP地址的动态分配。
  >
  > DHCP的主要功能是自动化地管理和分配IP地址，以简化网络配置和管理的过程。以下是DHCP协议的一些关键特点和工作机制：
  >
  > 1. IP地址分配：DHCP服务器负责分配IP地址给连接到网络的设备。当设备加入网络时，它会发送一个DHCP请求消息广播到网络上的所有DHCP服务器，请求获取一个可用的IP地址。
  >
  > 2. 动态分配：DHCP协议支持IP地址的动态分配，即将临时或短期使用的IP地址分配给设备。IP地址租约的期限可以由DHCP服务器指定，设备在租约到期之前可以继续使用分配的IP地址。
  >
  > 3. 其他配置信息：除了IP地址，DHCP还可以为设备分配其他网络配置信息，如子网掩码、默认网关、DNS服务器、域名等。这些配置信息可以帮助设备正确地连接到网络和进行通信。
  >
  > 4. 自动续约：设备在使用分配的IP地址期间，会定期向DHCP服务器发送租约续约请求，以延长IP地址的使用期限。如果设备无法续约或租约到期，它将释放该IP地址，使其可供其他设备使用。
  >
  > 5. 静态分配：除了动态分配外，DHCP还支持静态分配，即将固定的IP地址分配给特定的设备。静态分配可以用于需要固定IP地址的设备，如服务器、打印机等

- DNS

  > DNS（Domain Name System）是互联网中用于将域名转换为对应IP地址的系统和协议。它提供了域名与IP地址之间的映射，使得用户可以通过易于记忆的域名来访问互联网上的资源。
  >
  > 在互联网中，每个设备都有一个唯一的IP地址，用于标识和定位设备。然而，IP地址由一串数字组成，对于人类来说不太友好且难以记忆。DNS的作用就是解决这个问题，它通过域名系统将易于记忆的域名转换为对应的IP地址。
  >
  > 以下是DNS的工作原理和关键概念：
  >
  > 1. 域名层次结构：域名系统使用了一种层次结构的命名方式。一个完整的域名由多个部分组成，按照从右到左的顺序，由点号分隔。例如，www.example.com是一个域名，com是顶级域名，example是二级域名，www是子域名。
  >
  > 2. DNS解析：当用户在浏览器中输入一个域名时，浏览器会向本地DNS服务器发送一个DNS查询请求。本地DNS服务器首先查找自身的DNS缓存，如果找到了对应的IP地址，则直接返回给浏览器。如果没有找到，本地DNS服务器将查询发送给根域名服务器。
  >
  > 3. 递归查询：本地DNS服务器会向根域名服务器发送递归查询请求。根域名服务器存储了全球顶级域名服务器的地址信息，它会告诉本地DNS服务器哪个顶级域名服务器负责处理该域名。
  >
  > 4. 迭代查询：本地DNS服务器向顶级域名服务器发送迭代查询请求。顶级域名服务器存储了二级域名服务器的地址信息，它会告诉本地DNS服务器哪个二级域名服务器负责处理该域名。
  >
  > 5. 进一步查询：本地DNS服务器继续向二级域名服务器发送查询请求，直到找到负责该域名的DNS服务器。
  >
  > 6. 返回结果：最终，本地DNS服务器会收到负责该域名的DNS服务器返回的IP地址，并将其存储在缓存中。然后，本地DNS服务器将IP地址返回给浏览器，使得浏览器能够与目标服务器建立连接并访问资源。
  >
  > DNS的设计使得域名解析能够高效、可靠地进行，大大简化了用户在互联网上的访问过程。它是互联网基础设施中不可或缺的一部分，使得用户可以使用方便的域名来访问网站、发送电子邮件等。

- CIDR

  > CIDR（Classless Inter-Domain Routing）是一种IP地址的编址和路由的方法，用于更有效地分配和管理IP地址。它取代了传统的分类编址方法，使得IP地址分配更加灵活和高效。
  >
  > 在传统的分类编址方法中，IP地址被分为A类、B类和C类网络，每个网络有固定数量的主机地址。这种方法在分配IP地址时存在浪费和不灵活的问题。CIDR引入了可变长度子网掩码（Variable Length Subnet Mask，VLSM）的概念，允许根据实际需要分配不同数量的IP地址给不同的网络。
  >
  > 以下是CIDR的一些关键概念和特点：
  >
  > 1. 前缀表示法：CIDR使用前缀表示法来表示IP地址和子网掩码的组合。前缀表示法由IP地址后面跟着斜线和一个数字表示子网掩码的位数，例如192.168.0.0/24表示子网掩码为255.255.255.0。
  >
  > 2. 可变长度子网掩码：CIDR允许使用不同长度的子网掩码，从而灵活地分配IP地址给不同的网络。较长的子网掩码表示有更多的主机位，可以分配更多的IP地址，而较短的子网掩码则用于较小的网络。
  >
  > 3. 聚合路由：CIDR使得路由表的管理更加高效。通过聚合多个连续的IP地址块，可以减少路由表的条目数量，提高路由的效率和可扩展性。
  >
  > 4. 网络划分：CIDR允许对一个IP地址块进行划分，以满足不同网络的需求。通过将一个大的IP地址块划分为多个较小的子网，可以更好地利用IP地址资源。
  >
  > CIDR的引入使得IP地址的管理更加灵活和高效，可以根据实际需要进行更精确的地址分配和路由控制。它对于互联网的发展和规模扩展起到了重要的作用，并成为现代网络中广泛应用的一种编址和路由方式。

- NAT

  > NAT（Network Address Translation）是一种网络协议和技术，用于在互联网上实现私有IP地址与公共IP地址之间的转换。它是一种在网络设备（如路由器、防火墙等）上实现的机制，允许多个设备通过共享单个公共IP地址访问互联网。
  >
  > NAT的主要功能是将内部私有IP地址转换为公共IP地址（出站流量）和将公共IP地址映射回内部私有IP地址（入站流量）。这种转换过程使得多个设备可以使用相同的公共IP地址与互联网进行通信，从而解决了IPv4地址短缺的问题。
  >
  > 以下是NAT的一些关键概念和工作原理：
  >
  > 1. 私有IP地址：私有IP地址是在私有网络内部使用的IP地址范围，如192.168.0.0/16、10.0.0.0/8等。这些地址在全球范围内是唯一的，但在公共互联网上是不可路由的，因此不能直接与互联网通信。
  >
  > 2. 公共IP地址：公共IP地址是在互联网上分配的全局唯一的IP地址。公共IP地址可以直接与互联网通信，并由互联网路由器进行转发。
  >
  > 3. NAT转换表：NAT设备维护一个转换表，记录着内部私有IP地址与外部公共IP地址之间的映射关系。这些映射关系通常是基于端口号来进行标识，以区分不同的设备和连接。
  >
  > 4. 出站流量：当内部设备发送数据包到互联网时，NAT设备会将数据包的源IP地址和端口号替换为公共IP地址和新的端口号。这样，数据包就可以在互联网上进行传输，接收方收到数据包后可以将响应发送回公共IP地址。
  >
  > 5. 入站流量：当互联网上的响应数据包到达NAT设备时，NAT设备会查找转换表，将目标IP地址和端口号替换为对应的内部私有IP地址和端口号。这样，数据包就可以正确地传递给内部设备。
  >
  > NAT技术的优势包括提供了IP地址的节约、网络安全性的增强（通过隐藏内部网络）、易于部署和管理等。然而，NAT也有一些限制，如可能引入一定的网络延迟、阻碍对端到端连接的支持等。
  >
  > 需要注意的是，随着IPv6的推广和使用，IPv6地址空间相对较大，不再面临IPv4地址短缺的问题，因此NAT在IPv6网络中的需求较少。

- FTP

  > FTP（File Transfer Protocol）是一种用于在计算机网络上进行文件传输的协议。它允许用户通过客户端和服务器之间的交互，实现文件的上传、下载和管理。
  >
  > FTP使用客户端-服务器模型进行通信，其中客户端是发起文件传输请求的一方，而服务器是提供文件存储和传输服务的一方。以下是FTP的一些关键概念和工作原理：
  >
  > 1. 客户端和服务器：FTP客户端是运行FTP客户端软件的用户设备，它负责发起文件传输请求，并与FTP服务器建立连接。FTP服务器是运行FTP服务器软件的设备，它存储文件并响应客户端的请求。
  >
  > 2. 命令通道和数据通道：FTP使用两个通道进行通信。命令通道是客户端和服务器之间的控制通道，用于发送命令和控制信息。数据通道是用于实际文件传输的通道，客户端和服务器通过它传输文件数据。
  >
  > 3. 被动模式和主动模式：在FTP的数据传输过程中，可以使用被动模式或主动模式。在被动模式下，服务器监听一个固定的端口，等待客户端建立数据连接。在主动模式下，服务器主动连接客户端指定的端口进行数据传输。
  >
  > 4. 文件操作：FTP提供了一系列命令和操作，用于文件的上传、下载和管理。用户可以使用命令如FTP登录、列出目录内容、创建目录、删除文件、重命名文件等来操作文件。
  >
  > 5. 认证和安全：为了进行安全的文件传输，FTP支持用户认证机制，通常需要提供用户名和密码进行身份验证。也可以使用加密协议如FTPS（FTP over SSL）或SFTP（SSH File Transfer Protocol）来保护文件传输的安全性。
  >
  > FTP是一个广泛使用的文件传输协议，特别适用于在本地设备和远程服务器之间传输大量文件或进行文件管理操作。它在Web开发、软件发布、文件备份等场景中经常被使用。然而，由于FTP传输的数据不加密，存在安全性风险，因此在敏感数据传输中，建议使用加密的FTP协议或其他安全的文件传输协议。

- SNMP

  > SNMP（Simple Network Management Protocol）是一种用于网络设备管理和监控的协议。它提供了一种标准的方式，使网络管理员能够远程监视和管理网络中的设备、收集性能数据和配置信息，并对网络设备进行故障排除和性能优化。
  >
  > SNMP的工作原理基于客户端-服务器模型，其中网络设备被称为代理（Agent），而网络管理系统则是客户端。以下是SNMP的一些关键概念和工作流程：
  >
  > 1. 管理信息库（MIB）：MIB是一个层次化的数据库，用于存储网络设备的配置信息、状态信息和性能数据。MIB使用OID（Object Identifier）标识每个管理对象。
  >
  > 2. 管理器（Manager）：管理器是网络管理系统中运行的软件或设备，负责监视和管理网络中的代理设备。管理器可以向代理发送SNMP请求，获取设备的信息，也可以向代理发送SNMP命令，执行配置操作或触发特定的动作。
  >
  > 3. 代理（Agent）：代理是网络设备上运行的软件或硬件模块，负责响应来自管理器的SNMP请求。代理维护设备的MIB数据库，并提供对设备信息的访问和操作。
  >
  > 4. SNMP消息：SNMP使用消息进行管理信息的交换。主要的SNMP消息类型包括GetRequest（请求获取一个或多个对象的值）、GetNextRequest（请求获取下一个对象的值）、SetRequest（请求设置一个或多个对象的值）和Trap（代理主动向管理器发送的事件通知）等。
  >
  > 5. SNMP版本：SNMP有不同的版本，包括SNMPv1、SNMPv2c和SNMPv3。不同的版本支持不同的功能和安全特性。SNMPv3是最新的版本，提供了安全的消息传输和用户身份验证功能。
  >
  > 通过SNMP，网络管理员可以实时监视设备的性能指标，如带宽利用率、CPU使用率、内存利用率等。他们可以获取设备的配置信息，诊断和解决网络问题，进行设备的远程配置和管理。SNMP在网络设备管理和监控中扮演着重要的角色，被广泛应用于企业网络和运营商网络等各种网络环境中。

- AH

  > AH (Authentication Header) 是IPsec（Internet Protocol Security）协议套件中的一部分，用于提供数据的完整性、认证和防止重放攻击。它是一种在IP数据包中添加额外信息的安全扩展头部。
  >
  > AH的主要功能是对IP数据包进行身份验证和完整性保护，以确保数据在传输过程中不被篡改或伪造。以下是AH的一些关键特点和工作原理：
  >
  > 1. 认证：AH使用一种称为散列函数的算法来生成一个认证码（MAC，Message Authentication Code），用于验证IP数据包的完整性和真实性。认证码是基于IP数据包的源地址、目标地址、协议类型、有效载荷（如传输层协议头部和数据）等信息计算得出的。
  >
  > 2. 完整性保护：认证码的生成和验证过程可以确保数据在传输过程中没有被篡改或修改。如果数据包的任何部分被更改，认证码将无法通过验证，接收方可以检测到数据的篡改，并丢弃该数据包。
  >
  > 3. 防止重放攻击：AH使用一个称为序列号的字段来防止重放攻击。发送方将一个递增的序列号包含在每个IP数据包中，接收方使用序列号来检测和丢弃已经接收过的数据包。
  >
  > 4. 扩展头部：AH是通过添加一个扩展头部的方式嵌入到原始IP数据包中的。它位于IP头部之后，但在ESP（Encapsulating Security Payload）头部之前，如果同时使用了ESP和AH。
  >
  > 5. 仅提供认证：AH提供了数据的完整性和认证，但不提供加密功能。如果需要加密数据，可以结合使用ESP协议来提供加密和认证的功能。
  >
  > AH被广泛应用于安全敏感的网络环境，如VPN（Virtual Private Network）连接、跨网络的数据传输和身份验证等场景。它提供了一种可靠的机制来确保数据在传输过程中的完整性和真实性，同时抵御了一些网络攻击，如数据篡改和重放攻击。

- ESP

  > ESP（Encapsulating Security Payload）是IPsec（Internet Protocol Security）协议套件中的一部分，用于提供数据的机密性、完整性和可选的身份验证。它是一种在IP数据包中添加额外信息的安全扩展头部。
  >
  > ESP的主要功能是对IP数据包进行加密和认证，以确保数据在传输过程中的机密性和完整性。以下是ESP的一些关键特点和工作原理：
  >
  > 1. 加密：ESP使用对称加密算法对IP数据包的有效载荷进行加密，以防止未经授权的访问者读取和理解数据内容。加密过程使用密钥来转换数据，只有持有正确密钥的接收方才能解密数据。
  >
  > 2. 认证：ESP还使用一种称为散列函数的算法来生成一个认证码（MAC，Message Authentication Code），用于验证IP数据包的完整性和真实性。认证码是基于IP数据包的源地址、目标地址、协议类型、有效载荷等信息计算得出的。
  >
  > 3. 完整性保护：认证码的生成和验证过程可以确保数据在传输过程中没有被篡改或修改。如果数据包的任何部分被更改，认证码将无法通过验证，接收方可以检测到数据的篡改，并丢弃该数据包。
  >
  > 4. 扩展头部：ESP是通过添加一个扩展头部的方式嵌入到原始IP数据包中的。它位于IP头部之后，如果同时使用了AH（Authentication Header），则AH头部位于ESP头部之前。
  >
  > 5. 选择性的身份验证：ESP可以选择是否进行身份验证，也可以选择使用哪种算法进行认证。它可以与AH协议结合使用，以提供更强的身份验证和完整性保护。
  >
  > ESP广泛应用于需要保护数据机密性和完整性的网络通信场景，特别是在VPN连接、跨网络的数据传输和保护敏感信息的通信中。它提供了一种可靠的机制来确保数据在传输过程中的保密性和完整性，同时还可以提供可选的身份验证功能。

- EKE

  >EKE（Encrypted Key Exchange）是一种密码协议，用于在通信双方之间进行密钥交换。它允许双方在不安全的通信渠道上协商并交换加密通信所需的密钥，同时提供保密性和完整性保护。
  >
  >EKE协议的设计目标是在双方之间建立一个共享密钥，而不依赖于公开密钥基础设施（PKI）。以下是EKE协议的一般步骤：
  >
  >1. 双方协商参数：双方在通信之前首先协商一些参数，如加密算法、哈希函数和随机数生成器等。这些参数用于后续的密钥生成和验证过程。
  >
  >2. 注册阶段：在注册阶段，一方充当注册服务器（Registration Server），另一方充当用户。用户选择一个口令（password），并将其发送给注册服务器。
  >
  >3. 口令验证：注册服务器使用口令和其他参数，通过一系列哈希和加密操作来验证用户的口令。如果验证成功，注册服务器将生成一个密钥（key）并将其发送给用户。
  >
  >4. 密钥确认：用户使用自己的口令和其他参数，执行与注册服务器相同的哈希和加密操作，以验证从注册服务器接收到的密钥的正确性。如果验证成功，用户也生成一个密钥。
  >
  >5. 密钥交换：双方现在都有了相同的密钥，可以在后续的通信中使用该密钥进行加密和解密操作。
  >
  >EKE协议的主要优点是不依赖于公开密钥基础设施，允许双方在不安全的通信渠道上交换密钥。然而，EKE协议也有一些安全性方面的限制和注意事项，如对口令的保密性要求较高，避免使用弱口令，以及防止中间人攻击等。
  >
  >需要注意的是，EKE是一种基于口令的密钥交换协议，现在已经有更为先进和安全的密钥交换协议可供选择，如Diffie-Hellman密钥交换、公钥密码体制等。

- MPLS

  > MPLS（Multiprotocol Label Switching）是一种在数据通信网络中用于高效转发数据包的技术和协议。它通过在数据包中引入标签（Label）来实现快速的数据转发和路由决策。
  >
  > MPLS的核心思想是将数据包从其网络层地址（如IP地址）解耦，并附加一个短的标签。这个标签包含了转发数据包所需的路由信息，而不是依赖传统的最长前缀匹配查找。一旦标签被附加到数据包中，网络设备可以根据标签进行快速转发，而不需要每个路由器都进行完整的路由查找。
  >
  > 以下是MPLS的一些关键概念和工作原理：
  >
  > 1. 标签交换：MPLS网络中的每个路由器都有一个标签交换表（Label Switching Table），用于存储数据包标签和相应的出接口信息。当数据包到达路由器时，路由器根据标签进行快速转发，而不需要进行完整的路由查找。
  >
  > 2. 标签分发：MPLS使用一种称为标签分发协议（Label Distribution Protocol）的协议来分发标签和建立标签交换表。这个过程是动态的，当新的路由信息进入网络时，路由器之间会进行标签分发和交换，确保每个路由器都有正确的标签信息。
  >
  > 3. 隧道技术：MPLS还支持隧道技术，可以在现有网络架构之上创建虚拟的专用网络。这些隧道被称为MPLS隧道或LSP（Label Switched Path），它们可以通过不同的网络传输技术（如IP、ATM或以太网）跨越多个节点。
  >
  > 4. QoS支持：MPLS还提供了对服务质量（Quality of Service，QoS）的支持，可以根据不同的应用需求为数据包分配不同的优先级和带宽。
  >
  > MPLS在现代数据通信网络中广泛应用，特别是在广域网（WAN）和运营商网络中。它能够提供高效的数据转发和路由决策，提高网络性能和吞吐量，并支持多种网络传输技术的无缝互操作。

## IPv6的地址表示

IPv6（Internet Protocol version 6）是互联网协议的第六个版本，是目前广泛部署的IPv4（Internet Protocol version 4）的后继协议。IPv6的设计目标是解决IPv4所面临的地址枯竭问题，并提供更好的安全性、可扩展性和性能。

以下是IPv6的一些关键特点和改进：

1. 扩展的地址空间：IPv6采用128位的地址空间，相比IPv4的32位地址空间，IPv6提供了大量的IP地址，可解决IPv4中潜在的地址枯竭问题。IPv6的地址空间足够大，以支持未来的互联设备和应用的快速增长。

2. 改进的地址分配和配置：IPv6引入了更灵活的地址分配和配置机制，包括通过无状态地址自动配置（SLAAC）和动态主机配置协议（DHCPv6）进行地址分配，使网络设备能够更轻松地获取和配置IPv6地址。

3. 简化的头部格式：IPv6的报头相比IPv4更加简化，减少了报头的复杂性和处理开销。IPv6的报头包含了必要的字段，去除了IPv4中一些可选的字段，提高了数据包的处理效率。

4. 支持扩展和选项：IPv6的报头设计允许添加扩展头部和选项，以满足未来的需求和功能扩展。这使得IPv6更具灵活性和可扩展性，可以适应新的网络需求和安全机制的引入。

5. 内建的安全性支持：IPv6内建了对IP层的加密和认证支持，包括通过IPsec（Internet Protocol Security）协议提供的端到端的数据加密和认证功能。这使得IPv6在传输层上更容易实现安全通信。

6. 移动性支持：IPv6对移动设备的支持更加完善，包括通过移动IPv6（Mobile IPv6）协议实现设备的无缝漫游和地址迁移。这使得移动设备可以在不同网络之间保持连接，并保留其IPv6地址。

IPv6的部署和采用正在逐渐增加，尤其是随着互联设备的快速增长和IPv4地址枯竭的挑战。IPv6的广泛应用将为互联网提供更大的地址空间、更好的性能和安全性，推动新一代互联网的发展。同时，IPv6和IPv4之间的互通机制（如双栈和转换技术）也在逐步完善，以确保互联网的平稳过渡和互操作性。

IPv6地址采用128位的地址空间，与IPv4的32位地址空间相比更为庞大。为了表示这么长的地址，IPv6地址采用了一种新的表示方法。

IPv6地址的常见表示方式是使用冒号分隔的八组四位十六进制数（每组称为一个段），例如：

2001:0db8:85a3:0000:0000:8a2e:0370:7334

为了简化表示，IPv6地址允许压缩连续的0。在地址中，可以使用双冒号（::）来表示一个或多个连续的0段。但是，双冒号只能在地址中出现一次，用于避免歧义。

例如，上面的IPv6地址可以进一步压缩为：

2001:db8:85a3::8a2e:370:7334

注意，在压缩表示中，双冒号代表了一个或多个连续的0段。

此外，IPv6地址还支持使用IPv4地址的表示形式，称为IPv4映射地址。IPv4映射地址将IPv4地址嵌入到IPv6地址中，采用以下格式：

::ffff:IPv4地址

例如，IPv4地址 192.0.2.1 在IPv6的表示为：

::ffff:192.0.2.1

这种表示形式方便IPv4和IPv6之间的互操作性。

IPv6地址的长度和表示方式使得它具备了极大的扩展性和地址资源，能够满足未来互联设备的需求。

IPv6地址空间根据其用途和分配方式进行了一些划分和分配。以下是IPv6地址的几种常见划分方式：

1. 全球单播地址（Global Unicast Address）：这是公共的全球可路由的IPv6地址，用于直接在互联网上进行通信。全球单播地址由全球唯一的前缀标识和设备标识（Interface ID）组成。
2. 链路本地地址（Link-Local Address）：这些地址用于同一个链路上的通信，不经过路由器。链路本地地址由链路前缀（Link-Local Prefix）和设备标识组成，前缀通常为fe80::/10。
3. 站点本地地址（Site-Local Address）：这些地址用于站点内部的通信，类似于IPv4的私有地址。然而，IPv6已经弃用了站点本地地址的概念，并推荐使用全球单播地址进行站点内部通信。
4. 唯一本地地址（Unique Local Address）：这些地址用于在私有网络内进行通信，类似于IPv4的私有地址。唯一本地地址由前缀（fc00::/7）和子网标识（Subnet ID）组成。
5. 多播地址（Multicast Address）：多播地址用于一对多的通信，数据包可以被发送到一组特定的设备。IPv6多播地址由ff00::/8前缀和特定的标识组成。

此外，还有其他一些特殊用途的IPv6地址，如环回地址（::1）、未指定地址（::）、文本表示的IPv6地址（例如IPv4映射地址），以及一些保留的地址块用于特定的协议和用途。

IPv6地址的划分和分配是由互联网号码分配机构（RIRs）和网络管理员根据IPv6地址规划和需求进行管理和配置的。

## 常用协议默认端口号

1. HTTP (Hypertext Transfer Protocol): 80
2. HTTPS (Hypertext Transfer Protocol Secure): 443
3. FTP (File Transfer Protocol): 21
4. FTPS (FTP Secure): 990
5. SSH (Secure Shell): 22
6. Telnet: 23
7. SMTP (Simple Mail Transfer Protocol): 25
8. POP3 (Post Office Protocol version 3): 110
9. IMAP (Internet Message Access Protocol): 143
10. DNS (Domain Name System): 53
11. DHCP (Dynamic Host Configuration Protocol): 67 (Server), 68 (Client)
12. SNMP (Simple Network Management Protocol): 161
13. NTP (Network Time Protocol): 123
14. RDP (Remote Desktop Protocol): 3389
15. SIP (Session Initiation Protocol): 5060 (UDP)
16. LDAP (Lightweight Directory Access Protocol): 389
17. RADIUS (Remote Authentication Dial-In User Service): 1812 (Authentication), 1813 (Accounting)
18. SQL (Structured Query Language) Server: 1433
19. MySQL Server: 3306
20. PostgreSQL: 5432

# 3 数字证书和PKI

*Chapter 9*

## 数字证书

*P242*

数字证书是用于加密和验证网络通信的一种安全技术。它用于验证公共密钥的真实性和身份，并确保数据在互联网上的传输过程中不被篡改。

数字证书是由称为证书颁发机构（Certificate Authority，CA）的可信任第三方实体颁发的。它包含了一对密钥：公钥和私钥。公钥是用于加密数据和验证数字签名的密钥，而私钥则用于解密数据和生成数字签名。

当一个实体（如网站、电子邮箱等）希望证明其身份时，它可以向证书颁发机构申请数字证书。颁发机构将对该实体的身份进行验证，并在确认后为其签发数字证书。该数字证书包含了实体的**公钥和其他相关信息**，以及**颁发机构的数字签名**。

在进行安全通信时，接收方可以使用颁发机构的公钥来验证数字证书的签名，并使用实体的公钥进行数据加密。这样，接收方就可以确信发送方的身份和数据的完整性，以及通过加密确保数据的保密性。

### 数字证书的基本字段

- **版本**：数字证书的版本
- **证书编号**
- **签名算法标识符**
- **签名者**：CA的可区分名
- **有效期**
- **主体名**
- **主体公钥信息**

### 数字证书的生成

数字证书生成与管理主要涉及的参与方有**最终用户、注册机构（RA）、证书机构（CA）**。

从技术上说，RA是CA和用户的中间实体。因为CA任务繁多，所以设置了RA分担CA的压力。

1. 密钥生成

   由用户或RA生成密钥对

2. 注册

   制作**证书签名请求**（Certificate Signing Request，CSR），发给RA

3. 验证

   RA验证用户资料

   RA验证用户是否有公钥对应私钥（Proof of Possession，POP）

4. 证书生成

   CA生成证书

### 数字证书的验证

验证证书链

1. 获取消息摘要算法
2. 用户使用证书中内容生成消息摘要1
3. 用户取出CA的数字签名
4. 用户使用CA的公钥对签名进行验证
5. 获取消息摘要2
6. 比较消息摘要1和消息摘要2

### 数字证书撤销的常见原因

- 数字证书持有者报告证书中的公钥对应的私钥被盗
- CA发现签发数字证书时出错
- 证书持有者离职

### 证书撤销列表CRL

CRL（Certificate Revocation List）只有在**有效期**内**因故**被撤销的证书。（有效期外被撤销的没有）

## PKI

### PKI组成

- **CA（证书机构）**
- **RA（注册机构）**
- **策略管理**
- **证书管理**
- **密钥**
- **密钥备份与恢复**
- **撤销系统**

### PKI和PMI的区别

- PKI进行身份验证：你是谁

- PMI进行授权管理：你能干什么

## PMI

*P261*

- AA 属性权威（类比CA）
- AC属性证书（类比数字证书）

### PMI的基本模型

- 目标：被保护的资源
- 权限持有者
- 权限验证者

## 认证服务一般过程

设甲验证乙的身份。

1. 乙将证书给甲
2. 甲用CA公钥解开证书上CA的数字签名 -> 验证乙证书真伪
3. 乙将“口令”的签名给甲
4. 甲用证书上的公钥检查口令的签名 -> 验证乙口令真伪

## 数字信封

数字信封机制是一种用于保护数据隐私和安全的加密技术。它通过使用对称密钥加密和非对称密钥加密相结合的方式来实现数据的保密性和完整性。

在数字信封机制中，发送方首先使用随机生成的对称密钥对数据进行加密。对称密钥是一种加密和解密数据所使用的相同密钥。然后，发送方使用接收方的公钥进行非对称加密，将对称密钥加密为密文，并将其与加密后的数据一起发送给接收方。

接收方收到密文后，使用自己的私钥进行解密，获取到加密的对称密钥。然后，接收方使用该对称密钥对加密的数据进行解密，还原出原始的明文数据。

数字信封机制的关键点是使用非对称密钥对对称密钥进行加密和解密。这样做的好处是，非对称加密算法的公钥可以公开传输，而私钥则只有接收方持有，因此保证了对称密钥的安全性。同时，对称密钥的使用提供了高效的加密和解密操作，使得数据的传输更加快速。

# 4 网络加密和密钥管理

## 加密方式的比较

*P268*

- 链路加密

  链路加密仅在通信链路上提供安全性，在一个网络节点，消息以明文形式存在。因此，所有节点在物理上必须是安全的，否则就会泄漏明文内容。然而，要保证每个节点的安全性需要较高的费用。

- 节点加密

  与链路加密不同：节点加密不允许消息在网络节点以明文形式存在。它先把收到的消息进行解密，然后釆用另一个不同的密钥进行加密。这一过程在节点上的一个安全模块中进行。 节点加密要求报头和路由信息以明文形式传输，以便中间节点能得到如何处理消息的信息。因此这种方法对于防止攻击者分析通信业务是脆弱的。

  和链路相比，节点加密把加密模块放在了节点内。

- 端到端加密

  对于传送通路上的各中间节点，数据是保密的；各对用户采用相同的算法和密钥进行加密。

  和链路加密、端到端加密相比，端到端加密的消息不需要同步，中间节点无需加解密。

- 混合加密

  采用端到端加密方式只能对报文加密，报头则以明文形式传送，容易受业务流量分 析攻击。为了保护报头中的敏感信息，可以用端到端和链路混合加密方式。 在此方式下，报文将被两次加密，报头则只由链路方式进行加密。

## 密钥种类

*P274*

- 基本密钥（Base Key）

  aka用户密钥，在较长时间内有一对用户使用的密钥。

- 会话密钥（Session Key）

  使用时间较短，在通信时建立。使用会话密钥使用户不必频繁更换基本密钥。

- 密钥加密密钥（Key Encryption Key）

  aka次主密钥	

- 主机主密钥（Host Master Key）

  对KEK进行加密

## 密钥有效期

## 好密钥和坏密钥

*P276*

## 密钥分配

- 利用**安全信道**
- 利用**双钥体制**建立安全信道
- 利用**量子技术**实现密钥传递

## 可信第三方

Trusted Third Parties，TTP

CA就属于是一种TTP。

参与方式：**协调、脱机、联机**

- 协调方式下，T为中间人，实时为AB提供通信服务
- 脱机方式下，T不实时参与A和B的协议，而预先向A和B提供协议执行所需要的信息
- 联机方式下，T实时参与A和B的协议，但A和B通信不必经过T

## 密钥认证

*P281*

# 5 防火墙原理和设计

*Chapter12 P326*

OSI模型

- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 链路层
- 物理层

## 防火墙对数据流的处理方式

- 允许数据流通过
- 拒绝数据流通过（发消息）
- 丢弃数据流（不发消息）

## 防火墙基本功能

- 起初作为路由器的模块过滤
- 随后从路由器中独立成为独立设备

## 防火墙类型

根据过滤层次：

- **包过滤防火墙**
- **电路级网关防火墙**
- **应用级网关防火墙**

根据防火墙结构：

- 静态包过滤：网络层

- 动态包过滤：网络层/ 传输层

  - 具有状态感知能力：如果外网进内网的TCP包是内网向外网的request的回应，则直接放行

  - 能感受到新建连接和已建连接之间的区别

- 电路级网关：会话层

  - 检查TCP或UDP会话
  - 检查连接的握手信息和序列号

- 应用级网关：应用层

  - 对每个服务需要设置不同的代理

- 状态检查包过滤：七层均可

- 切换代理：先工作在会话层，后工作在网络层

  - 动态包过滤+电路级网关

- 空气隙

  - 类似应用级网关，但应用级网关分享内存，空气隙分享公用高速硬盘


## 防火墙工作的网络层级

防火墙通常工作在网络层（网络层级）和传输层（传输层级）之间，以保护计算机网络和系统免受未经授权的访问和恶意攻击。

在网络层级，防火墙通过检查网络层（IP层）的数据包，根据预先定义的规则和策略来决定是否允许或拦截数据包的传输。防火墙可以基于源IP地址、目标IP地址、端口号、协议类型等网络层信息来进行过滤和控制。

在传输层级，防火墙可以检查和过滤传输层协议（如TCP、UDP）的数据包。它可以监视和控制传输层连接的建立、终止和状态，以及检查传输层协议头中的端口号和其他相关信息。

防火墙的工作位置可以是网络中的单个设备（例如独立的防火墙设备）或嵌入在路由器、交换机、网关等网络设备中。无论防火墙是以硬件设备还是软件应用的形式存在，其目标都是保护网络的安全，控制流量并防止未经授权的访问和恶意行为。

## 防火墙检查的字段

- 静态包过滤防火墙
  - 源IP
  - 源端口
  - 目的IP
  - 目的端口
  - 应用或协议
- 动态包过滤防火墙
  - 源IP
  - 源端口
  - 目的IP
  - 目的端口
  - 应用或协议
- 电路级网关防火墙
  - 源IP
  - 源端口
  - 目的IP
  - 目的端口
  - 应用或协议
  - **握手信息和序列号**

## 静态包防火墙的工作原理

## 包过滤防火墙的规则定制

# 6 入侵检测系统

*Chapter13 P364*

## 通用入侵检测模型

- 数据收集器

- 检测器

- 知识库

  为检测器和控制器提供必需的数据信息支持。这些信息包括：用户历史活动档案或检测规则集合等。

- 控制器

  根据从检测器发来的警报信号，人工或自动地对入侵行为做出响应。

## IDS

Intrusion Detection System, IDS

### IDS的三个任务

- 信息收集

  > IDS所收集的信息内容包括用户（合法用户和非法 用户）在网络、系统、数据库及应用系统中活动的状态和行为。为了准确地收集用户的信息活动，需要在信息系统中的若干个关键点（包括不同网段、不同主机、不同数据库服务器、不同应用服务器等处）设置信息探测点。
  >
  > IDS可利用的信息：
  >
  > - 系统和网络的日志文件
  > - 目录和文件中的异常改变
  > - 程序执行中的异常行为
  > - 物理形式的入侵信息

- 信息分析

  > 对收集到的上述4类信息，包括网络、系统、数据及用户活动的状态和行为信息等进行模式匹配、统计分析和完整性分析，得到实时检测所必需的信息。

- 安全响应

### IDS分类

*P373*

按入侵检测策略：

- 滥用检测

  将收集到的信息与已知的网络入侵和系统误用模式数据库进行比较，从而发现违背安全策略的问题。

  缺点是不能检测零日漏洞。

- 异常检测

  首先给系统对象(如用户、文件、目录和设备等) 创建一个统计描述、统计正常使用时的一些测量属性(如访问次数、操作失败次数和延时等)。测量属性的平均值将被用来与网络、系统的行为进行比较，如果观察值在正常范围之外，就认为有入侵发生。

  缺点是误报率高。

- 完整性分析

  关注某个文件或对象是否被更改，这通常包括文件和目录的内容及属性，它在发现更改或特洛伊木马应用程序方面特别有效。只要成功的攻击导致了文件或其他对象的任何改变，它都能发现。

  缺点是不易于实时响应。

### IDS控制台

*P386*

控制台设计

> 控制台通过直观、方便的操作界面管理远程探测器，汇总各个探测器报告的告警事件，并实现日志检索、备份、恢复、报表等功能。控制台的设计重点是日志检索、探测器管理、规则管理、日志报表及用户管理等。

- 日志检索
- 探测器管理
- 规则管理
- 日志报表
- 用户管理

### DIDS

Distributed Intrusion Detection System

*P385 采用DIDS的原因*

> 在实际应用中，经常发现如下一些现象：
>
> 1. 系统的弱点或漏洞分散在网络的各个主机上，这些弱点有可能被入侵者一起用来攻击网络，而依靠唯一的主机或网络，IDS不能发现入侵行为。
> 2. 入侵行为不再是单一的行为，而表现出协作入侵的特点，如分布式拒绝服务攻击(DDoS)。
> 3. 入侵检测所依靠的数据来源分散化，收集原始数据变得困难，如交换网络使得监听网络数据包受到限制。
> 4. 网络传输速度加快，网络的流量大，集中处理原始数据的方式往往造成检测瓶颈，从而导致漏检。 
>
> 为了解决上述问题，DIDS应运而生。DIDS通常由数据采集构件、通信传输构件、入侵检测分析构件、应急处理构件和用户管理构件等组成。

# 7 VPN技术

*Chatpter14 P392*

实现VPN的关键技术

- 隧道技术
- 加解密技术
- 密钥管理技术
- 身份认证技术
- 访问控制

## VPN特点

- 费用低
- 安全保障
- QoS（服务质量保证）
- 可扩充性和灵活性
- 可管理性

## VPN分类

根据访问方式：

- 远程访问VPN
- 网关 - 网关VPN

根据类型：

- IPSec VPN
- PPTP VPN
- MPLS VPN
- SSL VPN（TLS VPN）

## 隧道协议

### 第2层隧道协议

先将各种网络协议封装到PPP，再将数据包装入隧道协议

#### PPTP

#### L2F

#### L2TP

结合了PPP和L2F，没有定义标准加密协议

### 第3层隧道协议

直接将各种网络协议装入隧道协议，形成的数据包靠第三层协议进行传输

#### IPSec

*P399*

- 传输模式：只对payload进行加密认证
- 隧道模式：对整个IP package进行加密认证
- 协议
  - **AH**（Authentication Header）：只负责认证，可抵御重放攻击
  - **ESP**（Encapsulating Security Payload）：负责加密，同时提供认证支持
  - **IKE**（Internet Key Exchange）：负责密钥管理
- 构成
  - **管理模块**
  - **密钥分配和生成模块**
  - **身份认证模块**
  - **数据加解密模块**
  - **数据分组封装/分解模块**
  - **加密函数库**
  - **和TLS VPN的比较**

#### GRE

Generic Routing Encapsulation

#### MPLS

Multiprotocol Label Switching

# 8 身份认证

*Chapter15 P420*

## 身份认证分类

- **身份验证**：“你是否是你所声称的你？ ”
- **身份识别**：“我是否知道你是谁？ ”

## 身份认证基本途径

- **所知**：个人所知道或所掌握的知识
- **所有**：个人所具有的东西
- **个人特征**：指纹、笔迹、声纹、手型、脸型、血型、视网膜、 虹膜、DNA及个人一些动作方面的特征等

## 身份证明常用指标

- 拒绝率（False Rejection Rate，FRR）aka 虚报率（I型错误率）

  > 合法用户遭到拒绝的概率

- 漏报率（False Acceptance Rate，FAR，II型错误率）

  >非法用户伪造身份成功的概率

## 口令认证系统

口令是一种根据已知事物验证身份的方法，也是一种被广泛使用的身份验证方法。 

### 询问法：一种口令认证的实现方式

提问一系列互不相关的问题：

- 你原来的中学校长是谁？
- 你的祖母多大？
- 你最喜欢的音乐专辑？

### 口令控制措施

*P425*

1. 系统消息(System Message)：一般系统在联机和脱机时都显示一些礼貌性用语， 而成为识别该系统的线索，因此这些系统应当可以抑制这类消息的显示，口令当然更不能显示。
2. 限制试探次数：不成功传送口令一般限制为3至6次，超过限定试验次数，系统将该用户ID锁定，直到重新认证授权后再开启。
3. 口令有效期：限定口令的使用期限。
4. 双口令系统：首先输入联机口令，在接触敏感信息时还要输入一个不同的口令。
5. 最小长度：限制口令至少为6至8B以上，防止猜测成功的概率过大，可采用掺杂(Salting)或采用通行短语(Passphrase)等加长和随机化。
6. 封锁用户系统：可以封锁长期未联机用户或口令超过使用期用户的ID号，直到用户重新被授权。
7. 根(Root)口令的保护：根口令是系统管理员访问系统时所用的口令，由于系统管理员被授予的权力远大于一般用户，因此管理员口令自然成为攻击者的攻击目标。因此，管理员口令在选择和使用中要倍加保护。管理员口令通常必须采用十六进制字符串，不能通过网络传送，并且要经常更换。
8. 系统生成口令“有些系统不允许用户自己选定口令，而是由系统生成和分配。系统如何生成易记忆又难以被猜中的口令是要解决的一个关键问题。如果口令难以记忆，则用户要将其写下来，这反而增加了口令泄漏的风险；若系统的口令生成算法被窃，则更加危险，因为这将危及整个系统的安全。

### 口令检验的方法

- 反应法

  利用一个程序(Cracker)让被检口令与一批易于猜中的口令表中的成员逐个比较，若都不相符，则通过。

- 支持法

  用户先自行选择一个口令。当用户第一次使用该口令时，系统利用一个程序检验其安全性。如果口令易于猜中，则拒绝登录，并请用户重新选一个口令。程序通过准则要考虑在可猜中性与安全性之间取得折中。

### 口令的安全存储

*P426*

- 用户的口令多以加密形式存储，入侵者要得到口令，必须知道加密算法和密钥。算法可能是公开的，但密钥只有管理员才知道。

- 许多系统可以存储口令的单向杂凑值，入侵者即使得到此杂凑值也难以推算出口令的明文。

## 个人特征的身份证明技术

原理

- 人体测量学
- 生物统计学

方法

- 手书签字验证
- 指纹验证
- 语音验证
- 视网膜图样验证
- 虹膜图样验证
- 脸型验证

## 一次性口令实现机制

*P431*

- 挑战/ 响应机制

  挑战/响应机制可以保证很高的安全性，但该机制存在一些缺陷：用户需多次手工输入数据，易造成较多的输入失误，使用起来十分不便；在整个认证过程中，客户端和服务器信息交互次数较多；挑战值每次都由服务器随机生成，使得服务器开销过大。

- 口令序列（S/key）机制

  该机制的致命弱点在于它只支持服务器对用户的单方面认证，无法防范假冒的服务 器欺骗合法用户。另外一个缺点是，当迭代值递减为0或用户的口令泄漏时间同步机制后，则必须对 S/key系统重新进行初始化。

- 时间同步机制

  时间同步机制的优点是：用户使用简单、方便，不需要像挑战/响应机制那样频繁地输入数据；一次认证的通信量小，通信效率高；服务器的计算量不是很大。 但是时间同步机制要求用户的手持令牌和服务器的时钟偏差不能太大，所以对设备的时钟精度要求比较高，设计成本较高。

- 事件同步机制

  事件同步机制类似于时间同步机制，用户操作简单；一次认证过程通信量小；可以防止小数攻击；服务器计算量稍大；系统实现比较简单，对设备的时钟精度没有要求。

  | 机制      | 通信量 | 系统实现复杂度 | 机制安全性 | 服务器计算量 |
  | --------- | ------ | -------------- | ---------- | ------------ |
  | 挑战/响应 | 大     | 简单           | 差         | 大           |
  | S/key     | 大     | 简单           | 差         | 大           |
  | 时间同步  | 小     | 复杂           | 好         | 小           |
  | 事件同步  | 小     | 简单           | 好         | 中           |

  

